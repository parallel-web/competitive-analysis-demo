<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitor Analysis Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
        @font-face {
            font-family: 'FT System Mono';
            src: url('https://assets.p0web.com/FTSystemMono-Regular.woff2') format('woff2');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'FT System Mono';
            src: url('https://assets.p0web.com/FTSystemMono-Medium.woff2') format('woff2');
            font-weight: 500;
            font-display: swap;
        }

        @font-face {
            font-family: 'FT System Mono';
            src: url('https://assets.p0web.com/FTSystemMono-Bold.woff2') format('woff2');
            font-weight: 700;
            font-display: swap;
        }

        @font-face {
            font-family: 'Gerstner Programm';
            src: url('https://assets.p0web.com/Gerstner-ProgrammRegular.woff2') format('woff2');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'Gerstner Programm';
            src: url('https://assets.p0web.com/Gerstner-ProgrammMedium.woff2') format('woff2');
            font-weight: 500;
            font-display: swap;
        }

        :root {
            --off-white: #fcfcfa;
            --index-black: #1d1b16;
            --neural: #d8d0bf;
            --signal: #fb631b;
        }

        body {
            font-family: 'FT System Mono', monospace;
            background-color: var(--off-white);
            color: var(--index-black);
        }

        .gerstner {
            font-family: 'Gerstner Programm', serif;
        }

        .neural-bg {
            background-color: var(--neural);
        }

        .signal-text {
            color: var(--signal);
        }

        .index-black-text {
            color: var(--index-black);
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .company-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #cbd5e1;
            border-radius: 16px;
            padding: 2rem;
        }

        .company-logo {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--signal), #ff8c42);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 1.5rem;
        }

        .analysis-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .analysis-card:hover {
            border-color: var(--signal);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .competitor-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .competitor-card:hover {
            border-color: var(--signal);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .confidence-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .confidence-high {
            background: #dcfce7;
            color: #166534;
        }

        .confidence-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .reasoning-section {
            background: #f8fafc;
            border-left: 4px solid var(--neural);
            border-radius: 0 8px 8px 0;
            padding: 1rem;
            margin-top: 1rem;
        }

        .citation-item {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .citation-item:hover {
            background: #e2e8f0;
            border-color: var(--signal);
        }

        .citation-link {
            color: var(--signal);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .citation-link:hover {
            text-decoration: underline;
        }

        .excerpt-text {
            font-style: italic;
            background: #f9fafb;
            border-left: 2px solid #d1d5db;
            padding: 0.5rem 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #374151;
        }

        .field-header {
            display: flex;
            align-items: center;
            justify-content: between;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .expand-toggle {
            background: none;
            border: none;
            color: var(--signal);
            cursor: pointer;
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .expand-toggle:hover {
            background: rgba(251, 99, 27, 0.1);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 2000px;
        }

        .insight-card {
            background: white;
            border-left: 4px solid var(--signal);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .market-position {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bae6fd;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #6b7280;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Header -->
    <header class="p-6 border-b border-gray-200">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <a href="/" class="gerstner text-2xl font-medium hover:text-gray-600 flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg"></div>
                    <span>Competitor Analysis</span>
                </a>
            </div>
            <a href="/" class="text-sm text-gray-600 hover:text-gray-800">‚Üê Back to analyses</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="py-12 px-6">
        <div class="max-w-6xl mx-auto">

            <!-- Loading State -->
            <div id="loading-state" class="text-center py-16 hidden">
                <div
                    class="loading-spinner w-12 h-12 border-4 border-gray-300 border-t-orange-500 rounded-full mx-auto mb-6">
                </div>
                <h2 class="gerstner text-2xl font-medium mb-4">Analyzing Competition...</h2>
                <p class="text-gray-600 max-w-md mx-auto mb-4">
                    Our AI is researching the company, identifying competitors, and mining Reddit for insights.
                </p>
                <div class="max-w-sm mx-auto bg-gray-200 rounded-full h-2 mb-4">
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full animate-pulse"
                        style="width: 45%"></div>
                </div>
                <p class="text-sm text-gray-500">This will take a bit. Come back in 30 minutes!</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="text-center py-16 hidden">
                <div
                    class="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                            clip-rule="evenodd" />
                    </svg>
                </div>
                <h2 class="gerstner text-2xl font-medium mb-4">Analysis Failed</h2>
                <p class="text-gray-600 mb-6" id="error-message"></p>
                <a href="/"
                    class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-2 font-medium hover:opacity-90 transition-colors rounded-lg">
                    Try Another Company
                </a>
            </div>

            <!-- Results State -->
            <div id="results-state" class="hidden">

                <!-- Company Header -->
                <div class="company-header mb-12">
                    <div class="flex items-start space-x-6">
                        <div class="company-logo" id="company-logo">
                            <!-- Company initial will be injected -->
                        </div>
                        <div class="flex-1">
                            <h1 class="gerstner text-3xl font-medium mb-2" id="company-name">
                                <!-- Company name will be injected -->
                            </h1>
                            <p class="text-gray-600 mb-2" id="company-domain">
                                <!-- Domain will be injected -->
                            </p>
                            <p class="text-sm text-gray-500 mb-4" id="company-location">
                                <!-- Location will be injected -->
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Company Stats -->
                <div class="stats-grid mb-12">
                    <div class="stat-item">
                        <div class="stat-label">Founded</div>
                        <div class="stat-value" id="founded-year">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Employees</div>
                        <div class="stat-value" id="employee-count">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Industry</div>
                        <div class="stat-value" id="industry-sector">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Funding</div>
                        <div class="stat-value" id="total-funding">-</div>
                    </div>
                </div>

                <!-- Company Overview -->
                <section class="market-position p-8 rounded-lg mb-12">
                    <h2 class="gerstner text-2xl font-medium mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Company Overview
                    </h2>
                    <div class="analysis-card" id="business-description-card">
                        <!-- Business description with reasoning will be injected -->
                    </div>
                </section>

                <!-- Market Analysis -->
                <section class="mb-12">
                    <h2 class="gerstner text-2xl font-medium mb-8 flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                        </svg>
                        Market Analysis
                    </h2>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="analysis-card" id="target-market-card">
                            <!-- Target market analysis will be injected -->
                        </div>
                        <div class="analysis-card" id="market-size-card">
                            <!-- Market size analysis will be injected -->
                        </div>
                    </div>
                </section>

                <!-- Competitors Analysis -->
                <section class="mb-12">
                    <h2 class="gerstner text-2xl font-medium mb-8 flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
                        </svg>
                        Key Competitors
                    </h2>
                    <div class="grid lg:grid-cols-1 gap-8" id="competitors-container">
                        <!-- Competitors will be injected here -->
                    </div>
                </section>

                <!-- Reddit Analysis -->
                <section class="mb-12">
                    <h2 class="gerstner text-2xl font-medium mb-8 flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z"
                                clip-rule="evenodd" />
                        </svg>
                        Reddit Community Analysis
                    </h2>
                    <div class="analysis-card" id="reddit-analysis-card">
                        <!-- Reddit analysis will be injected here -->
                    </div>
                </section>

                <!-- Executive Summary -->
                <section class="mb-12">
                    <h2 class="gerstner text-2xl font-medium mb-8 flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                clip-rule="evenodd" />
                        </svg>
                        Executive Summary
                    </h2>
                    <div class="analysis-card" id="executive-summary-card">
                        <!-- Executive summary will be injected here -->
                    </div>
                </section>

                <!-- CTA Section -->
                <div class="text-center mt-16 py-12 border-t border-gray-200">
                    <h3 class="gerstner text-2xl font-medium mb-6">Ready to analyze another company?</h3>
                    <a href="/"
                        class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-8 py-3 font-medium hover:opacity-90 transition-colors rounded-lg">
                        Analyze Competition
                    </a>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="py-8 px-6 border-t border-gray-200">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-600">Powered by Parallel AI</span>
                <a href="https://github.com/janwilmake/competitor-analysis" target="_blank"
                    class="text-orange-500 hover:text-orange-600 underline">
                    View on GitHub
                </a>
            </div>
            <div class="text-sm text-gray-600">
                Built for strategic insights
            </div>
        </div>
    </footer>

    <script>
        // Get data injected from server
        const data = window.data;
        const analysis = data.analysis;

        // Helper function to get basis for a field
        function getBasisForField(fieldName) {
            if (!analysis.result || !analysis.result.output || !analysis.result.output.basis) {
                return null;
            }
            return analysis.result.output.basis.find(basis => basis.field === fieldName);
        }

        // Helper function to create analysis card with reasoning and citations
        function createAnalysisCard(content, fieldName, title) {
            const basis = getBasisForField(fieldName);

            const cardHTML = `
                <div class="field-header">
                    <h3 class="font-semibold text-lg">${title}</h3>
                    ${basis?.confidence && basis.confidence !== "low" ? `<span class="confidence-badge confidence-${basis.confidence}">${basis.confidence} confidence</span>` : ''}
                    ${basis && (basis.citations.length > 0 || basis.reasoning) ? '<button class="expand-toggle" onclick="toggleDetails(this)">Show Details</button>' : ''}
                </div>
                <div class="content-text text-gray-700 leading-relaxed">${content}</div>
                ${basis ? `
                    <div class="collapsible-content">
                        ${basis.reasoning ? `
                            <div class="reasoning-section">
                                <h4 class="font-semibold text-sm mb-2 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    AI Reasoning
                                </h4>
                                <p class="text-sm text-gray-600">${basis.reasoning}</p>
                            </div>
                        ` : ''}
                        ${basis.citations && basis.citations.length > 0 ? `
                            <div class="mt-4">
                                <h4 class="font-semibold text-sm mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Sources (${basis.citations.length})
                                </h4>
                                <div class="space-y-2">
                                    ${basis.citations.map((citation, index) => `
                                        <div class="citation-item">
                                            <a href="${citation.url}" target="_blank" class="citation-link">
                                                [${index + 1}] ${citation.title || 'Source'}
                                            </a>
                                            ${citation.excerpts && citation.excerpts.length > 0 ? `
                                                <div class="mt-2">
                                                    ${citation.excerpts.map(excerpt => `
                                                        <div class="excerpt-text">"${excerpt}"</div>
                                                    `).join('')}
                                                </div>
                                            ` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                ` : ''}
            `;

            return cardHTML;
        }

        // Helper function to create competitor card
        function createCompetitorCard(competitor, competitorBasis) {
            const competitorDiv = document.createElement('div');
            competitorDiv.className = 'competitor-card mb-8';

            // Get basis for competitor fields
            const strengthsBasis = competitorBasis ? competitorBasis.find(b => b.field.includes('strengths')) : null;
            const weaknessesBasis = competitorBasis ? competitorBasis.find(b => b.field.includes('weaknesses')) : null;
            const redditBasis = competitorBasis ? competitorBasis.find(b => b.field.includes('reddit_sentiment')) : null;

            competitorDiv.innerHTML = `
                <div class="flex items-start space-x-4 mb-6">
                    <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center font-bold text-gray-700">
                        ${competitor.name.charAt(0)}
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-xl mb-2">${competitor.name}</h3>
                        <a href="${competitor.website}" target="_blank" class="text-sm text-orange-500 hover:underline mb-2 inline-block">${competitor.website}</a>
                        <p class="text-gray-700">${competitor.description}</p>
                        ${competitor.market_share ? `<p class="text-sm text-gray-600 mt-2"><strong>Market Position:</strong> ${competitor.market_share}</p>` : ''}
                    </div>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <div class="analysis-card">
                        <div class="field-header">
                            <h4 class="font-semibold text-green-700">Strengths</h4>
                            ${strengthsBasis ? `<span class="confidence-badge confidence-${strengthsBasis.confidence || 'medium'}">${strengthsBasis.confidence || 'medium'}</span>` : ''}
                        </div>
                        <p class="text-sm text-gray-700 mb-3">${competitor.strengths}</p>
                        ${strengthsBasis && strengthsBasis.citations && strengthsBasis.citations.length > 0 ? `
                            <details class="mt-3">
                                <summary class="text-xs cursor-pointer text-orange-500 hover:underline">View Sources (${strengthsBasis.citations.length})</summary>
                                <div class="mt-2 space-y-1">
                                    ${strengthsBasis.citations.map((citation, index) => `
                                        <a href="${citation.url}" target="_blank" class="block text-xs text-orange-500 hover:underline">
                                            [${index + 1}] ${citation.title || 'Source'}
                                        </a>
                                    `).join('')}
                                </div>
                            </details>
                        ` : ''}
                    </div>

                    <div class="analysis-card">
                        <div class="field-header">
                            <h4 class="font-semibold text-red-700">Weaknesses</h4>
                            ${weaknessesBasis ? `<span class="confidence-badge confidence-${weaknessesBasis.confidence || 'medium'}">${weaknessesBasis.confidence || 'medium'}</span>` : ''}
                        </div>
                        <p class="text-sm text-gray-700 mb-3">${competitor.weaknesses}</p>
                        ${weaknessesBasis && weaknessesBasis.citations && weaknessesBasis.citations.length > 0 ? `
                            <details class="mt-3">
                                <summary class="text-xs cursor-pointer text-orange-500 hover:underline">View Sources (${weaknessesBasis.citations.length})</summary>
                                <div class="mt-2 space-y-1">
                                    ${weaknessesBasis.citations.map((citation, index) => `
                                        <a href="${citation.url}" target="_blank" class="block text-xs text-orange-500 hover:underline">
                                            [${index + 1}] ${citation.title || 'Source'}
                                        </a>
                                    `).join('')}
                                </div>
                            </details>
                        ` : ''}
                    </div>

                    <div class="analysis-card">
                        <div class="field-header">
                            <h4 class="font-semibold text-blue-700">Reddit Sentiment</h4>
                            ${redditBasis ? `<span class="confidence-badge confidence-${redditBasis.confidence || 'medium'}">${redditBasis.confidence || 'medium'}</span>` : ''}
                        </div>
                        <p class="text-sm text-gray-700 mb-3">${competitor.reddit_sentiment}</p>
                        ${redditBasis && redditBasis.citations && redditBasis.citations.length > 0 ? `
                            <details class="mt-3">
                                <summary class="text-xs cursor-pointer text-orange-500 hover:underline">View Reddit Sources (${redditBasis.citations.length})</summary>
                                <div class="mt-2 space-y-1">
                                    ${redditBasis.citations.map((citation, index) => `
                                        <a href="${citation.url}" target="_blank" class="block text-xs text-orange-500 hover:underline">
                                            [${index + 1}] ${citation.title || 'Reddit Discussion'}
                                        </a>
                                    `).join('')}
                                </div>
                            </details>
                        ` : ''}
                    </div>
                </div>
            `;

            return competitorDiv;
        }

        // Toggle details function
        function toggleDetails(button) {
            const card = button.closest('.analysis-card');
            const collapsible = card.querySelector('.collapsible-content');

            if (collapsible.classList.contains('expanded')) {
                collapsible.classList.remove('expanded');
                button.textContent = 'Show Details';
            } else {
                collapsible.classList.add('expanded');
                button.textContent = 'Hide Details';
            }
        }

        // Make toggleDetails globally available
        window.toggleDetails = toggleDetails;

        // Show appropriate state
        if (analysis.status === 'pending') {
            document.getElementById('loading-state').classList.remove('hidden');

            // Poll for updates
            let initialContent = null;
            fetch(window.location.href)
                .then(response => response.text())
                .then(content => { initialContent = content; })
                .catch(error => console.error('Error fetching initial content:', error));

            const pollInterval = setInterval(async () => {
                try {
                    const response = await fetch(window.location.href);
                    if (response.ok) {
                        const currentContent = await response.text();
                        if (initialContent && currentContent !== initialContent) {
                            clearInterval(pollInterval);
                            window.location.reload();
                        }
                    }
                } catch (error) {
                    console.error('Polling error:', error);
                }
            }, 5000);

            setTimeout(() => clearInterval(pollInterval), 15 * 60 * 1000);

        } else if (analysis.error) {
            document.getElementById('error-state').classList.remove('hidden');
            document.getElementById('error-message').textContent = analysis.error;

        } else if (analysis.result && analysis.result.output) {
            document.getElementById('results-state').classList.remove('hidden');
            const result = analysis.result.output.content;

            // Populate basic company info
            const companyInitial = result.company_name ? result.company_name.charAt(0).toUpperCase() : '?';
            document.getElementById('company-logo').textContent = companyInitial;
            document.getElementById('company-name').textContent = result.company_name || 'Unknown Company';
            document.getElementById('company-domain').textContent = result.company_domain || '';
            document.getElementById('company-location').textContent = result.headquarters_location || '';

            // Populate stats
            document.getElementById('founded-year').textContent = result.founded_year || 'Unknown';
            document.getElementById('employee-count').textContent = result.employee_count || 'Unknown';
            document.getElementById('industry-sector').textContent = result.industry_sector || 'Unknown';
            document.getElementById('total-funding').textContent = result.total_funding_raised || 'Not disclosed';

            // Populate business description with analysis features
            document.getElementById('business-description-card').innerHTML = createAnalysisCard(
                result.business_description || 'No description available',
                'business_description',
                'Business Description'
            );

            // Populate target market analysis
            document.getElementById('target-market-card').innerHTML = createAnalysisCard(
                result.target_market_analysis || 'No target market analysis available',
                'target_market_analysis',
                'Target Market Analysis'
            );

            // Populate market size analysis
            document.getElementById('market-size-card').innerHTML = createAnalysisCard(
                result.market_size_and_growth || 'No market size data available',
                'market_size_and_growth',
                'Market Size & Growth'
            );

            // Populate Reddit analysis
            document.getElementById('reddit-analysis-card').innerHTML = createAnalysisCard(
                result.target_company_reddit_analysis || 'No Reddit analysis available',
                'target_company_reddit_analysis',
                `Reddit Analysis - ${result.reddit_overall_sentiment ? result.reddit_overall_sentiment.toUpperCase() + ' sentiment' : 'Unknown sentiment'}`
            );

            // Populate executive summary
            document.getElementById('executive-summary-card').innerHTML = createAnalysisCard(
                result.executive_summary || 'No executive summary available',
                'executive_summary',
                'Executive Summary'
            );

            // Populate competitors
            const competitorsContainer = document.getElementById('competitors-container');
            if (result.competitors && result.competitors.length > 0) {
                result.competitors.forEach((competitor, index) => {
                    // Try to find basis for this specific competitor
                    const competitorBasis = analysis.result.output.basis ?
                        analysis.result.output.basis.filter(b =>
                            b.field.includes(`competitors.${index}`) ||
                            b.field.includes(`competitors[${index}]`)
                        ) : null;

                    const competitorElement = createCompetitorCard(competitor, competitorBasis);
                    competitorsContainer.appendChild(competitorElement);
                });
            } else {
                competitorsContainer.innerHTML = '<div class="text-center text-gray-500 py-8">No competitors data available</div>';
            }
        }
    </script>
</body>

</html>