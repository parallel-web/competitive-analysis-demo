<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitor Analysis Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>

    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//www.google.com">
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com">
    <!-- Performance optimization -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">

    <!-- Preload critical fonts -->
    <link rel="preload" href="/FTSystemMono-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/FTSystemMono-Medium.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/FTSystemMono-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/Gerstner-ProgrammRegular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/Gerstner-ProgrammMedium.woff2" as="font" type="font/woff2" crossorigin>

    <!-- Preload logo SVG -->
    <link rel="preload" href="/dark-parallel-symbol-270.svg" as="image" type="image/svg+xml">

    <style>
        @font-face {
            font-family: 'FT System Mono';
            src: url('/FTSystemMono-Regular.woff2') format('woff2');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'FT System Mono';
            src: url('/FTSystemMono-Medium.woff2') format('woff2');
            font-weight: 500;
            font-display: swap;
        }

        @font-face {
            font-family: 'FT System Mono';
            src: url('/FTSystemMono-Bold.woff2') format('woff2');
            font-weight: 700;
            font-display: swap;
        }

        @font-face {
            font-family: 'Gerstner Programm';
            src: url('/Gerstner-ProgrammRegular.woff2') format('woff2');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'Gerstner Programm';
            src: url('/Gerstner-ProgrammMedium.woff2') format('woff2');
            font-weight: 500;
            font-display: swap;
        }

        :root {
            --off-white: #fcfcfa;
            --index-black: #1d1b16;
            --neural: #d8d0bf;
            --signal: #fb631b;
        }

        body {
            font-family: 'FT System Mono', monospace;
            background-color: var(--off-white);
            color: var(--index-black);
            line-height: 1.5;
            font-size: 14px;
        }

        .gerstner {
            font-family: 'Gerstner Programm', serif;
            line-height: 1.2;
        }

        .neural-bg {
            background-color: var(--neural);
        }

        .signal-text {
            color: var(--signal);
        }

        .index-black-text {
            color: var(--index-black);
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .company-header {
            background: #f8f8f6;
            border: 2px solid var(--neural);
            border-radius: 6px;
            padding: 32px;
            margin-bottom: 48px;
        }

        .company-logo {
            width: 64px;
            height: 64px;
            background: var(--signal);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 24px;
        }

        .company-logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .company-icon {
            width: 64px;
            height: 64px;
            border-radius: 4px;
            object-fit: cover;
            border: 2px solid var(--neural);
        }

        .analysis-card {
            background: white;
            border: 2px solid #e8e6e1;
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 24px;
            transition: border-color 0.2s ease;
        }

        .analysis-card:hover {
            border-color: var(--neural);
        }

        .competitor-card {
            background: white;
            border: 2px solid #e8e6e1;
            border-radius: 4px;
            padding: 24px;
            transition: border-color 0.2s ease;
            margin-bottom: 16px;
        }

        .competitor-card:hover {
            border-color: var(--signal);
        }

        .competitor-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .confidence-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 12px;
            border: 1px solid;
        }

        .confidence-high {
            background: #f0f9f4;
            color: #166534;
            border-color: #22c55e;
        }

        .confidence-medium {
            background: #fffbeb;
            color: #92400e;
            border-color: #f59e0b;
        }

        .confidence-low {
            background: #fef2f2;
            color: #991b1b;
            border-color: #ef4444;
        }

        .reasoning-section {
            background: #f8f8f6;
            border-left: 4px solid var(--neural);
            padding: 16px;
            margin-top: 16px;
            font-size: 13px;
        }

        .citation-item {
            background: #f5f5f3;
            border: 1px solid #d6d3ce;
            border-radius: 3px;
            padding: 12px;
            margin-bottom: 8px;
            transition: border-color 0.2s ease;
        }

        .citation-item:hover {
            border-color: var(--signal);
        }

        .citation-link {
            color: var(--signal);
            text-decoration: none;
            font-weight: 500;
            font-size: 13px;
        }

        .citation-link:hover {
            text-decoration: underline;
        }

        .excerpt-text {
            font-style: italic;
            background: #fafafa;
            border-left: 2px solid #d1d5db;
            padding: 8px 12px;
            margin-top: 8px;
            font-size: 12px;
            line-height: 1.4;
            color: #6b7280;
        }

        .field-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .expand-toggle {
            background: none;
            border: 1px solid var(--signal);
            color: var(--signal);
            cursor: pointer;
            font-size: 11px;
            padding: 6px 12px;
            border-radius: 3px;
            transition: all 0.2s ease;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .expand-toggle:hover {
            background: var(--signal);
            color: white;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 2000px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 48px;
        }

        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 4px;
            border: 2px solid #e8e6e1;
        }

        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #6b7280;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 500;
            color: var(--index-black);
        }

        .old-analysis-banner {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 48px;
        }

        .refresh-btn {
            background: var(--signal);
            color: white;
            padding: 8px 16px;
            border-radius: 3px;
            text-decoration: none;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: opacity 0.2s ease;
        }

        .refresh-btn:hover {
            opacity: 0.8;
        }

        .section-spacing {
            margin-bottom: 56px;
        }

        .content-wrapper {
            max-width: 1024px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .section-title {
            margin-bottom: 32px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e8e6e1;
            font-size: 24px;
            font-weight: 500;
        }

        .content-text {
            white-space: pre-line;
            font-size: 14px;
            line-height: 1.6;
            color: #374151;
        }

        .content-markdown {
            font-size: 14px;
            line-height: 1.6;
            color: #374151;
        }

        .content-markdown h1,
        .content-markdown h2,
        .content-markdown h3,
        .content-markdown h4,
        .content-markdown h5,
        .content-markdown h6 {
            font-family: 'Gerstner Programm', serif;
            font-weight: 500;
            color: var(--index-black);
            margin: 1.5em 0 0.5em 0;
        }

        .content-markdown h1 {
            font-size: 1.5em;
        }

        .content-markdown h2 {
            font-size: 1.3em;
        }

        .content-markdown h3 {
            font-size: 1.1em;
        }

        .content-markdown p {
            margin: 1em 0;
        }

        .content-markdown ul,
        .content-markdown ol {
            margin: 1em 0;
            padding-left: 2em;
        }

        .content-markdown li {
            margin: 0.5em 0;
        }

        .content-markdown strong {
            font-weight: 600;
            color: var(--index-black);
        }

        .content-markdown em {
            font-style: italic;
        }

        .content-markdown code {
            background: #f3f4f6;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'FT System Mono', monospace;
            font-size: 0.9em;
        }

        .content-markdown pre {
            background: #f8f8f6;
            border: 1px solid #e8e6e1;
            border-radius: 4px;
            padding: 1em;
            overflow-x: auto;
            margin: 1em 0;
        }

        .content-markdown pre code {
            background: none;
            padding: 0;
        }

        .content-markdown table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
            background: white;
            border: 2px solid #e8e6e1;
            border-radius: 4px;
            overflow: hidden;
        }

        .content-markdown th,
        .content-markdown td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e8e6e1;
        }

        .content-markdown th {
            background: #f8f8f6;
            font-weight: 600;
            color: var(--index-black);
            font-family: 'Gerstner Programm', serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 11px;
        }

        .content-markdown tr:last-child td {
            border-bottom: none;
        }

        .content-markdown tr:nth-child(even) {
            background: #fafafa;
        }

        .content-markdown blockquote {
            border-left: 4px solid var(--neural);
            background: #f8f8f6;
            padding: 1em 1.5em;
            margin: 1.5em 0;
            font-style: italic;
        }

        /* Ensure lists have proper display and spacing */
        .content-markdown ul,
        .content-markdown ol {
            display: block;
            margin: 1em 0;
            padding-left: 2em;
            list-style-position: outside;
        }

        .content-markdown ul {
            list-style-type: disc;
        }

        .content-markdown ol {
            list-style-type: decimal;
        }

        .content-markdown li {
            display: list-item;
            margin: 0.5em 0;
            line-height: 1.6;
        }

        /* Nested lists */
        .content-markdown ul ul,
        .content-markdown ol ul {
            list-style-type: circle;
            margin: 0.25em 0;
        }

        .content-markdown ul ul ul,
        .content-markdown ol ul ul {
            list-style-type: square;
        }

        .content-markdown ol ol,
        .content-markdown ul ol {
            list-style-type: lower-alpha;
            margin: 0.25em 0;
        }

        /* Ensure list markers are visible */
        .content-markdown ul li::marker,
        .content-markdown ol li::marker {
            color: var(--index-black);
        }

        /* Fix any potential conflicts with other styles */
        .content-markdown ul li,
        .content-markdown ol li {
            text-indent: 0;
            margin-left: 0;
            padding-left: 0;
        }

        .field-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--index-black);
        }

        .header-logo {
            display: flex;
            align-items: center;
            space-x: 12px;
        }

        .parallel-symbol {
            width: 32px;
            height: 32px;
            background: url('/dark-parallel-symbol-270.svg') no-repeat center;
            background-size: contain;
        }

        .cta-section {
            text-align: center;
            margin-top: 80px;
            padding: 64px 0;
            border-top: 2px solid #e8e6e1;
        }

        .cta-btn {
            background: var(--signal);
            color: white;
            padding: 16px 32px;
            font-weight: 500;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: opacity 0.2s ease;
        }

        .cta-btn:hover {
            opacity: 0.9;
        }

        .secondary-btn {
            background: white;
            color: var(--index-black);
            border: 2px solid var(--neural);
            padding: 16px 32px;
            font-weight: 500;
            border-radius: 4px;
            text-decoration: none;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
        }

        .secondary-btn:hover {
            border-color: var(--signal);
            color: var(--signal);
        }

        .agent-section {
            text-align: center;
            margin-top: 60px;
            padding: 48px 0;
            border-top: 2px solid #e8e6e1;
        }

        .agent-card {
            background: #f8f8f6;
            border: 2px solid var(--neural);
            border-radius: 6px;
            padding: 32px;
            max-width: 600px;
            margin: 24px auto 0;
        }

        .icon-terminal {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }

        .sources-line {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e8e6e1;
            font-size: 12px;
        }

        .source-link {
            color: var(--signal);
            text-decoration: none;
            font-weight: 500;
            margin-right: 8px;
        }

        .source-link:hover {
            text-decoration: underline;
        }

        .search-form {
            display: flex;
            align-items: center;
        }

        .search-input {
            padding: 8px 12px;
            border: 2px solid #e8e6e1;
            border-radius: 3px;
            font-size: 12px;
            background: white;
            width: 200px;
            margin-right: 8px;
            transition: border-color 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--signal);
        }

        .search-btn {
            background: var(--signal);
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
            transition: opacity 0.2s ease;
        }

        .search-btn:hover {
            opacity: 0.8;
        }

        .clickable-tag {
            display: inline-block;
            background: white;
            border: 2px solid var(--neural);
            padding: 4px 8px;
            margin: 2px 4px 2px 0;
            border-radius: 3px;
            color: var(--index-black);
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .clickable-tag:hover {
            border-color: var(--signal);
            color: var(--signal);
        }

        .category-tag {
            background: #f0f9f4;
            border-color: #22c55e;
            color: #166534;
        }

        .category-tag:hover {
            background: #dcfce7;
            border-color: #16a34a;
            color: #14532d;
        }

        .sentiment-indicator {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: 12px;
            border: 1px solid;
        }

        .sentiment-high {
            background: #f0f9f4;
            color: #166534;
            border-color: #22c55e;
        }

        .sentiment-medium {
            background: #fffbeb;
            color: #92400e;
            border-color: #f59e0b;
        }

        .sentiment-low {
            background: #fef2f2;
            color: #991b1b;
            border-color: #ef4444;
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding: 0 16px;
            }

            .company-header {
                padding: 24px;
                margin-bottom: 32px;
            }

            .analysis-card {
                padding: 20px;
                margin-bottom: 16px;
            }

            .competitor-card {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 32px;
            }

            .section-spacing {
                margin-bottom: 40px;
            }

            .section-title {
                font-size: 20px;
                margin-bottom: 24px;
            }

            body {
                font-size: 13px;
            }

            .agent-card {
                padding: 24px;
                margin-top: 20px;
            }

            .cta-btn,
            .secondary-btn {
                padding: 14px 24px;
                font-size: 12px;
            }

            .search-input {
                width: 150px;
            }

            .content-markdown table {
                font-size: 12px;
            }

            .content-markdown th,
            .content-markdown td {
                padding: 8px 12px;
            }
        }

        .error-icon,
        .loading-icon {
            width: 64px;
            height: 64px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .loading-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            background: #f3f4f6;
            border: 4px solid #e5e7eb;
            border-top: 4px solid var(--signal);
        }

        .error-icon {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Header -->
    <header class="py-6 border-b-2 border-gray-200">
        <div class="content-wrapper flex items-center justify-between">
            <div class="header-logo">
                <div class="parallel-symbol"></div>
                <a href="/" class="gerstner text-xl font-medium hover:text-gray-600 ml-3">
                    Competitor Analysis
                </a>
            </div>
            <div class="flex items-center space-x-4">
                <form class="search-form" onsubmit="performSearch(event)">
                    <input type="text" class="search-input" placeholder="Search categories, keywords..."
                        id="search-query">
                    <button type="submit" class="search-btn">Search</button>
                </form>
                <a href="/" class="text-gray-600 hover:text-gray-800 font-medium text-sm uppercase tracking-wide">
                    Back to analyses
                </a>
            </div>
        </div>
    </header>

    <!-- Disclaimer -->
    <div class="bg-gray-50 border-b border-gray-200 py-2">
        <div class="content-wrapper text-center">
            <p class="text-gray-600 text-xs">
                Powered by
                <a href="https://parallel.ai/blog/deep-research-benchmarks" target="_blank"
                    class="text-signal hover:underline font-medium">
                    Parallel ultra8x
                </a>
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="py-12">
        <div class="content-wrapper">

            <!-- Old Analysis Banner -->
            <div id="old-analysis-banner" class="old-analysis-banner hidden">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="mr-4">
                            <svg class="w-5 h-5 text-amber-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 9.586V6z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-amber-800 gerstner text-sm uppercase tracking-wide">
                                Analysis outdated
                            </p>
                            <p class="text-amber-700 text-xs mt-1">
                                This analysis is outdated. Market conditions may have changed.
                            </p>
                        </div>
                    </div>
                    <a href="#" id="refresh-link" class="refresh-btn">
                        Refresh
                    </a>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading-state" class="text-center py-24 hidden">
                <div class="loading-icon loading-spinner mx-auto mb-8"></div>
                <h2 class="gerstner text-2xl font-medium mb-6">Analyzing Competition...</h2>
                <p class="text-gray-600 max-w-lg mx-auto mb-6 text-sm leading-relaxed">
                    Our AI is researching the company, identifying competitors, and mining Reddit for insights.
                </p>
                <div class="max-w-md mx-auto bg-gray-200 rounded h-2 mb-6">
                    <div class="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded animate-pulse"
                        style="width: 45%"></div>
                </div>
                <p class="text-gray-500 text-xs uppercase tracking-wide">This will take about 30 minutes</p>
                <p class="text-gray-500 text-xs uppercase tracking-wide">Feel free to close this window and come back
                    later</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="text-center py-24 hidden">
                <div class="error-icon mb-8">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                            clip-rule="evenodd" />
                    </svg>
                </div>
                <h2 class="gerstner text-2xl font-medium mb-6">Analysis Failed</h2>
                <p class="text-gray-600 mb-8 text-sm" id="error-message"></p>
                <a href="/" class="cta-btn">
                    Try Another Company
                </a>
            </div>

            <!-- Results State -->
            <div id="results-state" class="hidden">

                <!-- Company Header -->
                <div class="company-header">
                    <div class="flex items-start space-x-6">
                        <div class="company-logo-container">
                            <img id="company-favicon" class="company-icon hidden" alt="Company logo">
                            <div class="company-logo" id="company-logo">
                                <!-- Company initial will be injected -->
                            </div>
                        </div>
                        <div class="flex-1">
                            <h1 class="gerstner text-3xl font-medium mb-3" id="company-name">
                                <!-- Company name will be injected -->
                            </h1>
                            <p class="text-gray-600 mb-2 font-mono text-sm" id="company-domain">
                                <!-- Domain will be injected -->
                            </p>
                            <p class="text-gray-500 mb-4 text-xs uppercase tracking-wide" id="company-location">
                                <!-- Location will be injected -->
                            </p>
                            <div class="mb-4">
                                <div class="mb-2">
                                    <span class="text-gray-500 text-xs uppercase tracking-wide mr-2">Category:</span>
                                    <span id="company-category-tag">
                                        <!-- Category will be injected -->
                                    </span>
                                </div>
                                <div class="mb-4">
                                    <span class="text-gray-500 text-xs uppercase tracking-wide mr-2">Keywords:</span>
                                    <div id="company-keywords" class="inline">
                                        <!-- Keywords will be injected -->
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <a href="#" id="linkedin-link"
                                    class="text-signal hover:underline font-medium text-xs uppercase tracking-wide hidden"
                                    target="_blank">LinkedIn</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Company Stats -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Founded</div>
                        <div class="stat-value" id="founded-year">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Employees</div>
                        <div class="stat-value" id="employee-count">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Industry</div>
                        <div class="stat-value" id="industry-sector">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Funding</div>
                        <div class="stat-value" id="total-funding">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Latest Round</div>
                        <div class="stat-value" id="latest-funding">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Valuation</div>
                        <div class="stat-value" id="current-valuation">-</div>
                    </div>
                </div>

                <!-- Company Snapshot -->
                <section class="section-spacing">
                    <h2 class="gerstner section-title">Company Snapshot</h2>

                    <!-- Executive Summary -->
                    <div class="analysis-card" id="executive-summary-card">
                        <!-- Executive summary will be injected here -->
                    </div>

                    <!-- Business Description -->
                    <div class="analysis-card" id="business-description-card">
                        <!-- Business description will be injected -->
                    </div>

                    <!-- Unique Value Proposition -->
                    <div class="analysis-card" id="unique-value-proposition-card">
                        <!-- Unique value proposition will be injected -->
                    </div>

                    <!-- Reddit Sentiment -->
                    <div class="analysis-card" id="reddit-analysis-card">
                        <!-- Reddit analysis will be injected here -->
                    </div>

                    <!-- Competitor Reddit Summary -->
                    <div class="analysis-card" id="competitor-reddit-summary-card">
                        <!-- Competitor Reddit summary will be injected here -->
                    </div>
                </section>

                <!-- Financial Analysis -->
                <section class="section-spacing">
                    <h2 class="gerstner section-title">Financial Overview</h2>

                    <!-- Investment Summary -->
                    <div class="analysis-card" id="investment-summary-card">
                        <!-- Investment summary will be injected -->
                    </div>
                </section>

                <!-- Product Analysis -->
                <section class="section-spacing">
                    <h2 class="gerstner section-title">Product & Pricing Analysis</h2>

                    <!-- Products Summary -->
                    <div class="analysis-card" id="products-summary-card">
                        <!-- Products summary will be injected -->
                    </div>

                    <!-- Pricing Summary -->
                    <div class="analysis-card" id="pricing-summary-card">
                        <!-- Pricing summary will be injected -->
                    </div>
                </section>

                <!-- Market Analysis -->
                <section class="section-spacing">
                    <h2 class="gerstner section-title">Understand the Market</h2>
                    <div class="grid lg:grid-cols-2 gap-6">
                        <div class="analysis-card" id="target-market-card">
                            <!-- Target market analysis will be injected -->
                        </div>
                        <div class="analysis-card" id="market-size-card">
                            <!-- Market size analysis will be injected -->
                        </div>
                    </div>
                    <div class="analysis-card" id="recent-news-card">
                        <!-- Recent news will be injected -->
                    </div>
                </section>

                <!-- Competitors Analysis -->
                <section class="section-spacing">
                    <h2 class="gerstner section-title">Competitive Landscape</h2>
                    <div class="analysis-card" id="competitive-landscape-card">
                        <!-- Competitive landscape overview will be injected -->
                    </div>
                    <div id="competitors-container">
                        <!-- Individual competitors will be injected here -->
                    </div>
                </section>

                <!-- Agent-Friendly Section -->
                <div class="agent-section">
                    <h3 class="gerstner text-xl font-medium mb-4">Agent-Friendly Competitor Analysis</h3>
                    <div class="agent-card">
                        <p class="text-gray-600 mb-6 text-sm leading-relaxed">
                            Perfect for AI agents and automated analysis. Get the complete competitor analysis
                            in structured markdown format with full context for all analyzed competitors.
                        </p>
                        <div class="flex flex-col gap-4 justify-center">
                            <a href="#" id="markdown-link" class="secondary-btn" target="_blank">
                                <svg class="icon-terminal" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M3 3h18v18H3V3zm2 2v14h14V5H5zm2 4l3 3-3 3 1.5 1.5L9 12l-4.5-4.5L6 9zm6 6h6v2h-6v-2z" />
                                </svg>
                                View Markdown Analysis
                            </a>
                            <a href="https://smithery.ai/server/@janwilmake/competitive-analysis-demo"
                                class="secondary-btn" target="_blank">
                                <svg class="icon-terminal" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                </svg>
                                Try the MCP Server
                            </a>
                        </div>
                    </div>
                </div>

                <!-- CTA Section -->
                <div class="cta-section">
                    <h3 class="gerstner text-xl font-medium mb-8">Ready to analyze another company?</h3>
                    <a href="/" class="cta-btn">
                        Analyze Competition
                    </a>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="py-8 border-t-2 border-gray-200">
        <div class="content-wrapper flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <span class="text-gray-600 text-xs uppercase tracking-wide">Powered by Parallel AI</span>
                <a href="https://github.com/parallel-web/competitive-analysis-demo" target="_blank"
                    class="text-signal hover:text-orange-600 underline text-xs">
                    GitHub
                </a>
            </div>
            <div class="text-gray-600 text-xs uppercase tracking-wide">
                Built for strategic insights
            </div>
        </div>
    </footer>

    <script>
        // Get data injected from server
        const data = window.data;
        const analysis = data.analysis;

        // Helper function to convert markdown to HTML using marked
        function convertMarkdown(text) {
            if (!text) return '';

            // Configure marked for tables and other features
            marked.setOptions({
                breaks: true,
                gfm: true
            });

            return marked.parse(text);
        }

        // Helper function to get basis for a field
        function getBasisForField(fieldName) {
            if (!analysis.result || !analysis.result.output || !analysis.result.output.basis) {
                return null;
            }
            return analysis.result.output.basis.find(basis => basis.field === fieldName);
        }

        // Helper function to create sources line
        function createSourcesLine(basis) {
            if (!basis || !basis.citations || basis.citations.length === 0) {
                return '';
            }

            const sourceLinks = basis.citations.map((citation, index) => {
                return `<a href="${citation.url}" target="_blank" class="source-link">[${index + 1}]</a>`;
            }).join('');

            return `<div class="sources-line">Sources: ${sourceLinks}</div>`;
        }

        // Helper function to create analysis card with reasoning and citations
        function createAnalysisCard(content, fieldName, title) {
            const basis = getBasisForField(fieldName);

            const cardHTML = `
                <div class="field-header">
                    <h3 class="field-title gerstner">${title}</h3>
                    ${basis ? '<button class="expand-toggle" onclick="toggleDetails(this)">Details</button>' : ''}
                </div>
                <div class="content-markdown">${convertMarkdown(content)}</div>
                ${basis && !basis.expanded ? createSourcesLine(basis) : ''}
                ${basis ? `
                    <div class="collapsible-content">
                        
                        ${basis.reasoning ? `
                            <div class="reasoning-section">
                                <h4 class="font-semibold mb-2 text-xs uppercase tracking-wide">AI Reasoning</h4>
                                <div class="text-gray-600">${convertMarkdown(basis.reasoning)}</div>
                                ${basis.confidence ? `<div class="mt-4">Confidence: ${basis.confidence}</div>` : ''}
                            </div>
                        ` : ''}
                        ${basis.citations && basis.citations.length > 0 ? `
                            <div class="mt-4">
                                <h4 class="font-semibold mb-3 text-xs uppercase tracking-wide">Sources (${basis.citations.length})</h4>
                                <div class="space-y-2">
                                    ${basis.citations.map((citation, index) => `
                                        <div class="citation-item">
                                            <a href="${citation.url}" target="_blank" class="citation-link">
                                                [${index + 1}] ${citation.title || 'Source'}
                                            </a>
                                            ${citation.excerpts && citation.excerpts.length > 0 ? `
                                                <div class="mt-2">
                                                    ${citation.excerpts.map(excerpt => `
                                                        <div class="excerpt-text">"${convertMarkdown(excerpt)}"</div>
                                                    `).join('')}
                                                </div>
                                            ` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                ` : ''}
            `;

            return cardHTML;
        }

        // Helper function to create competitor card
        // Helper function to create competitor card
        function createCompetitorCard(competitor) {
            // Extract domain from website URL
            let domain = competitor.website || competitor.hostname;
            try {
                domain = domain.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0];
            } catch (e) {
                // Keep original if parsing fails
            }

            if (!domain) {
                console.error("competitor has no website", competitor);
                return;
            }

            // Create clickable link for competitor
            const competitorLink = document.createElement('a');
            competitorLink.href = `/analysis/${domain}`;
            competitorLink.className = 'competitor-link';

            competitorLink.innerHTML = `
        <div class="competitor-card cursor-pointer">
            <div class="flex items-start space-x-4">
                <div class="company-logo-container relative">
                    <img src="https://www.google.com/s2/favicons?domain=${encodeURIComponent(domain)}&sz=64" 
                         alt="${competitor.name} logo"
                         class="w-12 h-12 rounded object-cover border border-gray-300"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="w-12 h-12 bg-gray-200 rounded hidden items-center justify-center font-bold text-gray-700 text-sm">
                        ${competitor.name.charAt(0)}
                    </div>
                </div>
                <div class="flex-1">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="gerstner text-lg font-medium">${competitor.name}</h3>
                        <a href="${competitor.website || `https://${competitor.hostname}`}" 
                           target="_blank" 
                           class="text-signal hover:text-orange-600 text-xs font-medium uppercase tracking-wide"
                           onclick="event.stopPropagation();">
                            Visit Site â†—
                        </a>
                    </div>
                    <span class="text-signal hover:underline text-xs font-mono block mb-1">${competitor.website || competitor.hostname}</span>
                    <span class="text-gray-600 text-xs">${competitor.description || ""}</span>
                </div>
            </div>
        </div>
    `;

            return competitorLink;
        }

        // Search function
        function performSearch(event) {
            event.preventDefault();
            const query = document.getElementById('search-query').value.trim();
            if (query) {
                window.location.href = `/search/${encodeURIComponent(query)}`;
            }
        }

        // Make functions globally available
        window.toggleDetails = toggleDetails;
        window.performSearch = performSearch;

        // Toggle details function
        function toggleDetails(button) {
            const card = button.closest('.analysis-card');
            const collapsible = card.querySelector('.collapsible-content');
            const sourcesLine = card.querySelector('.sources-line');

            if (collapsible.classList.contains('expanded')) {
                collapsible.classList.remove('expanded');
                button.textContent = 'Details';
                // Show sources line when collapsed
                if (sourcesLine) {
                    sourcesLine.style.display = 'block';
                }
            } else {
                collapsible.classList.add('expanded');
                button.textContent = 'Hide';
                // Hide sources line when expanded
                if (sourcesLine) {
                    sourcesLine.style.display = 'none';
                }
            }
        }

        // Show old analysis banner if needed
        if (data.isOld && analysis.status === 'done' && !analysis.error) {
            const banner = document.getElementById('old-analysis-banner');
            const refreshLink = document.getElementById('refresh-link');
            refreshLink.href = `/new?company=${encodeURIComponent(analysis.company_domain)}`;
            banner.classList.remove('hidden');
        }

        // Show appropriate state
        if (analysis.status === 'pending') {
            document.getElementById('loading-state').classList.remove('hidden');

            // Poll for updates
            let initialContent = null;
            fetch(window.location.href)
                .then(response => response.text())
                .then(content => { initialContent = content; })
                .catch(error => console.error('Error fetching initial content:', error));

            const pollInterval = setInterval(async () => {
                try {
                    const response = await fetch(window.location.href);
                    if (response.ok) {
                        const currentContent = await response.text();
                        if (initialContent && currentContent !== initialContent) {
                            clearInterval(pollInterval);
                            window.location.reload();
                        }
                    }
                } catch (error) {
                    console.error('Polling error:', error);
                }
            }, 5000);

            setTimeout(() => clearInterval(pollInterval), 15 * 60 * 1000);

        } else if (analysis.error) {
            document.getElementById('error-state').classList.remove('hidden');
            document.getElementById('error-message').textContent = analysis.error;

        } else if (analysis.result && analysis.result.output) {
            document.getElementById('results-state').classList.remove('hidden');
            const result = analysis.result.output.content;

            // Set up markdown link
            const markdownLink = document.getElementById('markdown-link');
            markdownLink.href = `/md/${analysis.company_domain}`;

            // Populate company favicon and logo
            const companyInitial = result.company_name ? result.company_name.charAt(0).toUpperCase() : '?';
            const faviconImg = document.getElementById('company-favicon');
            const logoDiv = document.getElementById('company-logo');

            faviconImg.src = `https://www.google.com/s2/favicons?domain=${encodeURIComponent(analysis.company_domain)}&sz=256`;
            faviconImg.alt = `${result.company_name || 'Company'} logo`;
            faviconImg.onload = function () {
                this.classList.remove('hidden');
                logoDiv.style.display = 'none';
            };
            faviconImg.onerror = function () {
                this.classList.add('hidden');
                logoDiv.style.display = 'flex';
            };

            logoDiv.textContent = companyInitial;

            // Populate basic company info
            document.getElementById('company-name').textContent = result.company_name || 'Unknown Company';
            document.getElementById('company-domain').textContent = result.company_domain || '';
            document.getElementById('company-location').textContent = result.headquarters_location || '';

            // Populate category
            const categoryTag = document.getElementById('company-category-tag');
            if (result.category) {
                categoryTag.innerHTML = `<a href="/search/${encodeURIComponent(result.category)}" class="clickable-tag category-tag">${result.category}</a>`;
            } else {
                categoryTag.textContent = 'Unknown';
                categoryTag.href = '#';
            }

            // Populate keywords
            const keywordsContainer = document.getElementById('company-keywords');
            if (result.keywords) {
                const keywords = result.keywords.split(',').map(k => k.trim()).filter(k => k);
                keywordsContainer.innerHTML = keywords.map(keyword =>
                    `<a href="/search/${encodeURIComponent(keyword)}" class="clickable-tag">${keyword}</a>`
                ).join('');
            } else {
                keywordsContainer.innerHTML = '<span class="text-gray-500 text-xs">No keywords available</span>';
            }

            // LinkedIn link
            const linkedinLink = document.getElementById('linkedin-link');
            if (result.linkedin_url && result.linkedin_url !== 'Not found') {
                linkedinLink.href = result.linkedin_url;
                linkedinLink.classList.remove('hidden');
            }

            // Populate stats
            document.getElementById('founded-year').textContent = result.founded_year || 'Unknown';
            document.getElementById('employee-count').textContent = result.employee_count || 'Unknown';
            document.getElementById('industry-sector').textContent = result.industry_sector || 'Unknown';
            document.getElementById('total-funding').textContent = result.total_funding_raised || 'Not disclosed';
            document.getElementById('latest-funding').textContent = result.latest_funding_round || 'Not disclosed';
            document.getElementById('current-valuation').textContent = result.current_valuation || 'Not disclosed';

            // Populate executive summary (moved to top under Company Snapshot)
            document.getElementById('executive-summary-card').innerHTML = createAnalysisCard(
                result.executive_summary || 'No executive summary available',
                'executive_summary',
                'Executive Summary'
            );

            // Populate business description
            document.getElementById('business-description-card').innerHTML = createAnalysisCard(
                result.business_description || 'No description available',
                'business_description',
                'Business Description'
            );

            // Populate unique value proposition
            document.getElementById('unique-value-proposition-card').innerHTML = createAnalysisCard(
                result.unique_value_proposition || 'No unique value proposition analysis available',
                'unique_value_proposition',
                'Unique Value Proposition'
            );

            // Populate Reddit analysis with sentiment indicator
            const sentimentClass = result.reddit_overall_sentiment === 'high' ? 'sentiment-high' :
                result.reddit_overall_sentiment === 'medium' ? 'sentiment-medium' :
                    result.reddit_overall_sentiment === 'low' ? 'sentiment-low' : '';

            const sentimentText = result.reddit_overall_sentiment ?
                `Reddit Analysis <span class="sentiment-indicator ${sentimentClass}">${result.reddit_overall_sentiment} sentiment</span>` :
                'Reddit Analysis';

            document.getElementById('reddit-analysis-card').innerHTML = createAnalysisCard(
                result.target_company_reddit_analysis || 'No Reddit analysis available',
                'target_company_reddit_analysis',
                `Reddit Analysis <small class="text-gray-500 text-xs ml-2">(Powered by Reddit MCP)</small>` +
                (sentimentClass ? ` <span class="sentiment-indicator ${sentimentClass}">${result.reddit_overall_sentiment} sentiment</span>` : '')
            );

            // Populate competitor Reddit summary
            document.getElementById('competitor-reddit-summary-card').innerHTML = createAnalysisCard(
                result.competitor_reddit_summary || 'No competitor Reddit summary available',
                'competitor_reddit_summary',
                `Competitor Reddit Analysis <small class="text-gray-500 text-xs ml-2">(Powered by Reddit MCP)</small>`
            );

            // Populate investment summary
            document.getElementById('investment-summary-card').innerHTML = createAnalysisCard(
                result.investment_summary || 'No investment summary available',
                'investment_summary',
                'Investment Summary'
            );

            // Populate products summary
            document.getElementById('products-summary-card').innerHTML = createAnalysisCard(
                result.products_summary || 'No products summary available',
                'products_summary',
                'Products & Features'
            );

            // Populate pricing summary
            document.getElementById('pricing-summary-card').innerHTML = createAnalysisCard(
                result.pricing_summary || 'No pricing summary available',
                'pricing_summary',
                'Pricing Strategy'
            );

            // Populate target market analysis
            document.getElementById('target-market-card').innerHTML = createAnalysisCard(
                result.target_market_analysis || 'No target market analysis available',
                'target_market_analysis',
                'Target Market Analysis'
            );

            // Populate market size analysis
            document.getElementById('market-size-card').innerHTML = createAnalysisCard(
                result.market_size_and_growth || 'No market size data available',
                'market_size_and_growth',
                'Market Size & Growth'
            );

            // Populate recent news
            document.getElementById('recent-news-card').innerHTML = createAnalysisCard(
                result.recent_news_developments || 'No recent news available',
                'recent_news_developments',
                'Recent News & Developments'
            );


            // Populate competitive landscape overview
            document.getElementById('competitive-landscape-card').innerHTML = createAnalysisCard(
                result.competitive_landscape_overview || 'No competitive landscape overview available',
                'competitive_landscape_overview',
                'Competitive Landscape Overview'
            );

            // Populate competitors
            const competitorsContainer = document.getElementById('competitors-container');
            if (result.competitors && result.competitors.length > 0) {
                result.competitors.forEach((competitor) => {
                    const competitorElement = createCompetitorCard(competitor);
                    competitorsContainer.appendChild(competitorElement);
                });
            } else {
                competitorsContainer.innerHTML = '<div class="analysis-card text-center text-gray-500 py-12"><p class="text-sm uppercase tracking-wide">No competitors data available</p></div>';
            }
        }
    </script>
</body>

</html>